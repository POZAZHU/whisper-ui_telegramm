<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Whisper WebUI — Mobile</title>
<style>
  :root{
    --bg1:#b88bd6; --bg2:#f5a6c9;
    --panel:rgba(255,255,255,.16);
    --panel2:rgba(255,255,255,.10);
    --soft:rgba(255,255,255,.32);
    --stroke:rgba(255,255,255,.45);
    --text:rgba(255,255,255,.95);
    --muted:rgba(255,255,255,.80);
    --ink:#4d2c79;
    --blur:22px;
    --shadow:0 18px 60px rgba(82,45,130,.35);
    --radius-xl:26px; --radius-lg:20px; --radius-md:16px;
  }

  /* === fixed background so no seams === */
  .bg{
    position:fixed; inset:0; z-index:-1;
    background:
      radial-gradient(900px 600px at 15% 18%, rgba(255,255,255,.25), transparent 60%),
      radial-gradient(700px 560px at 88% 85%, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(135deg, var(--bg1), var(--bg2));
    -webkit-user-select:none; user-select:none;
    will-change:transform;
  }

  html,body{height:auto; min-height:100%}
  body{
    margin:0;
    font-family: ui-rounded, system-ui, -apple-system, "SF Pro Rounded",
                 Inter, "Segoe UI", Roboto, Arial, sans-serif;
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;           /* НЕТ горизонтального скролла */
  }

  /* layout mobile-first */
  .wrap{
    min-height:100vh;
    display:flex; flex-direction:column; align-items:center;
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
    padding-bottom: max(12px, env(safe-area-inset-bottom));
    padding-top: 12px;
  }

  .card{
    box-sizing:border-box;
    width: calc(100vw - 24px);   /* всегда влезает на экран */
    max-width: 420px;
    border-radius:var(--radius-xl);
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    backdrop-filter: blur(var(--blur)) saturate(120%);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(120%);
    border:1px solid var(--soft);
    box-shadow:var(--shadow);
    padding:18px 16px 92px;      /* место под нижние кнопки */
    position:relative;
    overflow:hidden;             /* обрезаем внутренние эффекты по радиусу */
    margin: 0 auto;
  }
  .card::after{
    content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
    box-shadow:inset 0 0 0 1px var(--stroke),
               inset 0 12px 40px rgba(255,255,255,.18),
               inset 0 -18px 50px rgba(255,255,255,.10);
  }

  h1{margin:2px 0 10px; text-align:center; font-size:24px; font-weight:800; letter-spacing:.2px}
  .sub{color:var(--muted); text-align:center; font-size:12px; margin-bottom:6px}

  .section{margin-top:14px}
  .section-title{
    font-size:12px; color:var(--muted); letter-spacing:.35px; text-transform:uppercase;
    margin:10px 4px 10px; display:flex; align-items:center; gap:8px
  }

  /* groups */
  .group{
    border:1px solid var(--soft);
    border-radius:var(--radius-lg);
    padding:12px;
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
  }
  .vstack{display:flex; flex-direction:column; gap:10px}

  /* inputs/buttons */
  .btn{
    appearance:none; border:1px solid var(--soft);
    background:linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.12));
    border-radius:var(--radius-md); padding:14px 16px;
    font-weight:700; color:var(--text); width:100%;
    display:flex; align-items:center; justify-content:center; gap:10px;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.35), 0 8px 18px rgba(84,42,120,.25);
    transition:transform .05s;
  }
  .btn.soft{background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.10))}
  .btn:active{transform:translateY(1px)}
  .row{display:flex; gap:10px}
  .row>.btn{flex:1}

  .field{
    position:relative;
    border:1px solid var(--soft);
    border-radius:var(--radius-md);
    background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.10));
    box-shadow:inset 0 1px 0 rgba(255,255,255,.35), 0 6px 16px rgba(84,42,120,.18);
    display:flex; align-items:center;
    padding:10px 12px; gap:10px;
  }
  .field input, .field select{
    background:transparent; border:none; outline:none;
    color:var(--text); font-weight:600; flex:1; min-width:0;
    font-size:16px;
  }
  .field input::placeholder{color:rgba(255,255,255,.65)}
  .clear{border:none;background:transparent;color:var(--muted);font-weight:800}

  .toggle{
    display:flex; align-items:center; justify-content:space-between;
    border:1px solid var(--soft); border-radius:var(--radius-md);
    padding:12px; background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
  }
  .label{font-weight:700; color:var(--muted)}
  .switch{position:relative; width:52px; height:30px; border-radius:999px; background:rgba(255,255,255,.24); box-shadow:inset 0 2px 6px rgba(0,0,0,.15)}
  .switch input{display:none}
  .knob{position:absolute; top:3px; left:3px; width:24px; height:24px; border-radius:50%; background:white;
        box-shadow:0 3px 8px rgba(0,0,0,.2), inset 0 1px 0 rgba(255,255,255,.8); transition:left .18s ease}
  .switch input:checked + .knob{left:25px}
  .switch input:checked ~ .bg{background:linear-gradient(135deg,#9fd3ff,#cbb1ff)}
  .bg{position:absolute; inset:0; border-radius:inherit; z-index:-1}

  /* icon bubbles */
  .ico{width:22px;height:22px;border-radius:12px; display:grid;place-items:center;
       background:rgba(255,255,255,.28); box-shadow:inset 0 1px 0 rgba(255,255,255,.6)}
  .ico svg{width:14px;height:14px; stroke:var(--ink); stroke-width:1.8; fill:none; stroke-linecap:round; stroke-linejoin:round}
  .ico .fill{fill:var(--ink); stroke:none}

  /* sticky actions bottom — с учётом safe area */
  .actions{
    position:sticky;
    bottom: max(8px, env(safe-area-inset-bottom));
    display:flex; gap:10px; width:min(100%,420px); margin:12px auto 0;
    padding:8px;
  }
  .actions .btn{flex:1; padding:16px; font-size:15px}
  .btn.primary{background:linear-gradient(180deg, rgba(255,255,255,.24), rgba(255,255,255,.14))}

  /* очень узкие экраны */
  @media (max-width:360px){
    .card{ width: calc(100vw - 16px); border-radius:22px; }
    .actions .btn{ padding:14px; font-size:14px; }
  }
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>

<div class="wrap">
  <div class="card" role="group" aria-label="Whisper WebUI Mobile">

    <h1>Whisper WebUI</h1>
    <div class="sub">Mobile / Glassmorphism</div>

    <!-- INPUT SOURCE -->
    <div class="section">
      <div class="section-title">Input Source</div>
      <div class="group vstack">
        <div class="row">
          <button class="btn soft" id="btn-upload">
            <span class="ico"><svg viewBox="0 0 24 24"><path d="M4 19h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-2-2h-3.5l-2-2H8L6 10H4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2z"/><path d="M12 14V8M9.5 10.5 12 8l2.5 2.5"/></svg></span>
            Upload File
          </button>
          <button class="btn soft" id="btn-mic">
            <span class="ico"><svg viewBox="0 0 24 24"><rect x="9" y="4" width="6" height="10" rx="3"/><path d="M5 11a7 7 0 0 0 14 0M12 18v3"/></svg></span>
            Microphone
          </button>
        </div>

        <!-- YouTube URL field -->
        <div class="field" id="yt-field">
          <span class="ico"><svg viewBox="0 0 24 24"><path class="fill" d="M21 8.5c-.1-1.2-1-2.2-2.2-2.3C16.8 6 12 6 12 6s-4.8 0-6.8.2C3 6.3 2.1 7.3 2 8.5 1.8 10 1.8 12 1.8 12s0 2 .2 3.5c.1 1.2 1 2.2 2.2 2.3C7.2 18 12 18 12 18s4.8 0 6.8-.2c1.2-.1 2.1-1.1 2.2-2.3.2-1.5.2-3.5.2-3.5s0-2-.2-3.5z"/></svg></span>
          <input id="input-url" type="url" inputmode="url" placeholder="YouTube URL" autocomplete="on" />
          <button class="clear" id="clear-url" aria-label="Очистить">×</button>
        </div>
      </div>
    </div>

    <!-- MODEL SETTINGS -->
    <div class="section">
      <div class="section-title">Model Settings</div>
      <div class="vstack">
        <label class="field">
          <span class="ico"><svg viewBox="0 0 24 24"><path d="M4 7h12M4 17h16M16 7V5M8 17v-2"/></svg></span>
          <select id="sel-model">
            <option value="small">Whisper Model: small</option>
            <option value="base">base</option>
            <option value="medium">medium</option>
            <option value="large-v3">large-v3</option>
          </select>
        </label>

        <label class="field">
          <span class="ico"><svg viewBox="0 0 24 24"><path d="M3 12h18M12 3c3 3.5 3 14.5 0 18M12 3c-3 3.5-3 14.5 0 18"/></svg></span>
          <select id="sel-lang">
            <option value="auto">Language: Auto</option>
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="es">Español</option>
          </select>
        </label>

        <div class="toggle">
          <div class="label">Voice Activity Detection (VAD)</div>
          <label class="switch">
            <input type="checkbox" id="tog-vad" checked>
            <span class="knob"></span><span class="bg"></span>
          </label>
        </div>

        <div class="toggle">
          <div class="label">Subtitle Translation</div>
          <label class="switch">
            <input type="checkbox" id="tog-translate">
            <span class="knob"></span><span class="bg"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- POSTPROCESSING -->
    <div class="section">
      <div class="section-title">Postprocessing</div>
      <div class="vstack">
        <div class="toggle">
          <div class="label">Speaker Diarisation</div>
          <label class="switch">
            <input type="checkbox" id="tog-diar">
            <span class="knob"></span><span class="bg"></span>
          </label>
        </div>
        <div class="toggle">
          <div class="label">Segment by Pause</div>
          <label class="switch">
            <input type="checkbox" id="tog-segpause" checked>
            <span class="knob"></span><span class="bg"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- sticky actions -->
    <div class="actions">
      <button class="btn primary" id="btn-generate">
        <span class="ico"><svg viewBox="0 0 24 24"><path class="fill" d="M9 7l8 5-8 5z"/></svg></span>
        Generate &amp; Play
      </button>
      <button class="btn soft" id="btn-download">
        <span class="ico"><svg viewBox="0 0 24 24"><path d="M12 3v10M8.5 9.5 12 13l3.5-3.5"/><path d="M4 20h16"/></svg></span>
        Download
      </button>
    </div>

  </div>
</div>

<script>
  // basic YouTube check
  function isYouTube(u){
    try{
      const x = new URL(u);
      return /(^|\.)youtube\.com$/.test(x.hostname) || /(^|\.)youtu\.be$/.test(x.hostname);
    }catch{ return false; }
  }

  // Telegram WebApp integration
  const tg = window.Telegram && window.Telegram.WebApp;
  if(tg){
    tg.expand();
    const showMB = () => {
      const url = document.getElementById('input-url').value.trim();
      tg.MainButton.setText('Отправить в бота');
      if(url) tg.MainButton.show(); else tg.MainButton.hide();
    };
    ['input','change'].forEach(ev=>{
      document.querySelectorAll('input,select').forEach(el=>el.addEventListener(ev, showMB));
    });
    tg.MainButton.onClick(()=>sendPayload('generate'));
  }

  function collectConfig(){
    return {
      youtube_url: document.getElementById('input-url').value.trim(),
      model:       document.getElementById('sel-model').value,
      lang:        document.getElementById('sel-lang').value,
      vad:         document.getElementById('tog-vad').checked,
      translate:   document.getElementById('tog-translate').checked,
      diar:        document.getElementById('tog-diar').checked,
      segpause:    document.getElementById('tog-segpause').checked
    };
  }

  function sendPayload(action){
    const payload = collectConfig();
    payload.action = action || 'generate';
    const url = payload.youtube_url;
    if(!url || !isYouTube(url)){
      alert('Укажи корректную ссылку на YouTube.');
      return;
    }
    if(tg){ tg.sendData(JSON.stringify(payload)); }
    else { alert('Payload:\n'+JSON.stringify(payload,null,2)); }
  }

  // UI events
  document.getElementById('clear-url').onclick = () => {
    document.getElementById('input-url').value = '';
  };
  document.getElementById('btn-generate').onclick = () => sendPayload('generate');
  document.getElementById('btn-download').onclick = () => sendPayload('download');
  document.getElementById('btn-upload').onclick = () => alert('Загрузка файла (мобильный) — placeholder');
  document.getElementById('btn-mic').onclick = () => alert('Микрофон (мобильный) — placeholder');
</script>
</body>
</html>
